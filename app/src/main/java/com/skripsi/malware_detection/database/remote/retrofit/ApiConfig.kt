package com.skripsi.malware_detection.database.remote.retrofit

import android.content.Context
import com.skripsi.malware_detection.BuildConfig
import okhttp3.OkHttpClient
import okhttp3.logging.HttpLoggingInterceptor
import retrofit2.Retrofit
import retrofit2.converter.gson.GsonConverterFactory

object ApiConfig {
    fun getExtractionService(context: Context): ExtractionApiService {
        val prefs = context.getSharedPreferences("mdns_config", Context.MODE_PRIVATE)
        val baseUrls = prefs.getString("mdns_url", null) ?:
            throw IllegalStateException("mDNS service not selected")

        val loggingInterceptor = if(BuildConfig.DEBUG) { HttpLoggingInterceptor().setLevel(
            HttpLoggingInterceptor.Level.BASIC) }else { HttpLoggingInterceptor().setLevel(
            HttpLoggingInterceptor.Level.NONE) }

        val client = OkHttpClient.Builder()
            .addInterceptor(loggingInterceptor)
            .build()

        val retrofit = Retrofit.Builder()
            .baseUrl(baseUrls)
            .addConverterFactory(GsonConverterFactory.create())
            .client(client)
            .build()

        return retrofit.create(ExtractionApiService::class.java)
    }

    fun getExtractionResultService(context: Context): ExtractionResultApiService {
        val prefs = context.getSharedPreferences("mdns_config", Context.MODE_PRIVATE)
        val baseUrls = prefs.getString("mdns_url", null) ?:
        throw IllegalStateException("mDNS service not selected")

        val loggingInterceptor = if(BuildConfig.DEBUG) { HttpLoggingInterceptor().setLevel(
            HttpLoggingInterceptor.Level.BASIC) }else { HttpLoggingInterceptor().setLevel(
            HttpLoggingInterceptor.Level.NONE) }

        val client = OkHttpClient.Builder()
            .addInterceptor(loggingInterceptor)
            .build()

        val retrofit = Retrofit.Builder()
            .baseUrl(baseUrls)
            .addConverterFactory(GsonConverterFactory.create())
            .client(client)
            .build()

        return retrofit.create(ExtractionResultApiService::class.java)
    }
}