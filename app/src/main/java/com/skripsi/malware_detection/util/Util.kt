package com.skripsi.malware_detection.util

import android.os.Build
import androidx.annotation.RequiresApi
import java.text.SimpleDateFormat
import java.util.Locale
import kotlin.math.floor

object Util {

    private val sizeMapping = arrayOf("B", "KB", "MB", "GB", "TB")

    fun formatTimestampMilis(timestamp: Long): String{
        val formatter = SimpleDateFormat("dd MMMM yyyy HH:mm:ss", Locale.getDefault())
        return formatter.format(timestamp)
    }

    @RequiresApi(Build.VERSION_CODES.O)
    fun formatTimestampString(timestamp: String): String {
        return try {
            val instant = java.time.Instant.parse(timestamp)
            val formatter = java.time.format.DateTimeFormatter
                .ofPattern("dd MMMM yyyy HH:mm:ss")
                .withLocale(Locale.getDefault())
                .withZone(java.time.ZoneId.systemDefault())

            formatter.format(instant)
        }
        catch (e: Exception) {
            timestamp
        }
    }

    fun formatFileSize(byte: Int): String{
        var size = byte.toDouble()
        var index = 0

        while(size >= 1000 && index < sizeMapping.lastIndex){
            size /= 1000
            index++
        }

        val formatted =
            String.format(Locale.ENGLISH, "%.1f", size)
                .replace(".", ",")

        return "$formatted ${sizeMapping[index]}"
    }

    fun formatSecond(secondInput: Double): String {
        var seconds = floor(secondInput).toLong()

        val hours = seconds / 3600
        seconds %= 3600

        val minutes = seconds / 60
        seconds %= 60

        return when {
            hours > 0 -> "${hours}h ${minutes}m"
            minutes > 0 -> "${minutes}m ${seconds}s"
            else -> "${seconds}s"
        }
    }
}